{% extends "base.html" %} {% block title %}Categorize Text - TextTools{%
endblock %} {% block extra_head %}
{% endblock %} {% block content %}
<h1>Categorize Text</h1>
<p>Enter text and provide categories to classify it.</p>

<form id="categorizeForm">
  <div>
    <label for="text">Text:</label>
    <textarea
      id="text"
      name="text"
      required
      placeholder="Enter your text here..."
    ></textarea>
  </div>

  <div>
    <label>Categories:</label>
    <div id="categoriesContainer" class="categories-container">
      <div class="category-input">
        <input
          type="text"
          class="category"
          placeholder="Category name"
          required
        />
        <button
          type="button"
          class="remove-category"
          onclick="removeCategory(this)"
        >
          ✕
        </button>
      </div>
    </div>
    <button type="button" class="add-category" onclick="addCategory()">
      + Add Category
    </button>
  </div>

  <div>
    <label>
      <input type="checkbox" id="withAnalysis" name="with_analysis" />
      Include analysis (reasoning step)
    </label>
  </div>

  <div>
    <label for="temperature">Temperature (0-2):</label>
    <input
      type="number"
      id="temperature"
      name="temperature"
      step="0.1"
      min="0"
      max="2"
      value="0.0"
    />
  </div>

  <div>
    <label for="userPrompt">Custom Prompt (optional):</label>
    <input
      type="text"
      id="userPrompt"
      name="user_prompt"
      placeholder="Additional instructions"
    />
  </div>

  <button type="submit">Categorize</button>
  <div id="loading" class="loading">Processing...</div>
</form>

<div id="result" class="result" style="display: none">
  <h2>Result:</h2>
  <pre id="output"></pre>
</div>

<script>
  function addCategory() {
    const container = document.getElementById("categoriesContainer");
    const div = document.createElement("div");
    div.className = "category-input";
    div.innerHTML = `
            <input type="text" class="category" placeholder="Category name" required>
            <button type="button" class="remove-category" onclick="removeCategory(this)">✕</button>
        `;
    container.appendChild(div);
  }

  function removeCategory(btn) {
    const container = document.getElementById("categoriesContainer");
    if (container.children.length > 1) {
      btn.parentElement.remove();
    } else {
      alert("You need at least one category.");
    }
  }

  document
    .getElementById("categorizeForm")
    .addEventListener("submit", async (e) => {
      e.preventDefault();

      // Collect categories
      const categoryInputs = document.querySelectorAll(".category");
      const categories = [];
      categoryInputs.forEach((input) => {
        if (input.value.trim()) categories.push(input.value.trim());
      });

      if (categories.length === 0) {
        alert("Please enter at least one category.");
        return;
      }

      // Build request payload
      const payload = {
        text: document.getElementById("text").value,
        categories: categories,
        with_analysis: document.getElementById("withAnalysis").checked,
        temperature: parseFloat(document.getElementById("temperature").value),
        user_prompt: document.getElementById("userPrompt").value || null,
      };

      // Show loading
      document.getElementById("loading").style.display = "block";
      document.getElementById("result").style.display = "none";

      try {
        const response = await fetch("/tools/categorizations", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await response.json();

        if (response.ok) {
          document.getElementById("output").textContent = JSON.stringify(
            data.output,
            null,
            2,
          );
          document.getElementById("result").style.display = "block";
        } else {
          alert("Error: " + (data.detail || "Unknown error"));
        }
      } catch (error) {
        alert("Network error: " + error.message);
      } finally {
        document.getElementById("loading").style.display = "none";
      }
    });
</script>
{% endblock %}
